<svg xmlns="http://www.w3.org/2000/svg" id="mainsvg" width="907" height="796" viewBox="-10 -10 907 796"><defs><marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z"/></marker><filter id="shadowfilter" x="-20%" y="-20%" width="150%" height="150%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="linearRGB"><feDropShadow stdDeviation="4 4" in="SourceGraphic" dx="1" dy="1" flood-color="#BABABA" flood-opacity="0.9" x="0%" y="0%" width="100%" height="100%" result="dropShadow"/></filter><filter id="shadowfilter2" x="0" y="0" width="200%" height="200%" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/><feOffset dy="4" dx="2"/><feGaussianBlur stdDeviation="2"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/></filter></defs><g transform="translate(0, 0)"><rect width="66" height="39" stroke="#555656" fill="white" stroke-width="1.3" transform="translate(0, 0)" rx="2" filter="url(#shadowfilter)"/><text fill="black" font-size="16" font-weight="normal" transform="translate(10, 10)" alignment-baseline="middle" font-family="Bookman"><tspan x="0" dy="16">agent x</tspan></text></g><g transform="translate(274, 0)"><rect width="80" height="39" stroke="#555656" fill="white" stroke-width="1.3" transform="translate(0, 0)" rx="2" filter="url(#shadowfilter)"/><text fill="black" font-size="16" font-weight="normal" transform="translate(10, 10)" alignment-baseline="middle" font-family="Bookman"><tspan x="0" dy="16">hub:8000</tspan></text></g><g transform="translate(603, 0)"><rect width="54" height="39" stroke="#555656" fill="white" stroke-width="1.3" transform="translate(0, 0)" rx="2" filter="url(#shadowfilter)"/><text fill="black" font-size="16" font-weight="normal" transform="translate(10, 10)" alignment-baseline="middle" font-family="Bookman"><tspan x="0" dy="16">client</tspan></text></g><path d="M 33,74 L 314 74" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 33,82 L 43 82 L 43 101 L 33 101" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,113 L 324 113 L 324 132 L 314 132" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,144 L 324 144 L 324 163 L 314 163" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 630,198 L 314 198" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 314,229 L 630 229" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 630,260 L 314 260" fill="none" stroke="black" stroke-dasharray="4,4" stroke-width="1" marker-end="url(#arrow)"/><path d="M 314,291 L 33 291" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,322 L 314 322" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 314,330 L 324 330 L 324 349 L 314 349" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1" marker-end="url(#arrow)"/><path d="M 33,361 L 43 361 L 43 380 L 33 380" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,392 L 324 392 L 324 411 L 314 411" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,423 L 43 423 L 43 442 L 33 442" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,454 L 43 454 L 43 473 L 33 473" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,508 L 314 508" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,516 L 324 516 L 324 535 L 314 535" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,570 L 630 570" fill="none" stroke="black" stroke-dasharray="4,4" stroke-width="1" marker-end="url(#arrow)"/><path d="M 630,578 L 640 578 L 640 597 L 630 597" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 630,609 L 640 609 L 640 628 L 630 628" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 630,663 L 314 663" fill="none" stroke="black" stroke-dasharray="4,4" stroke-width="1" marker-end="url(#arrow)"/><path d="M 314,671 L 324 671 L 324 690 L 314 690" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 314,725 L 33 725" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,733 L 43 733 L 43 752 L 33 752" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1.6" marker-end="url(#arrow)"/><path d="M 33,39 L 33 776" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1"/><path d="M 314,39 L 314 776" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1"/><path d="M 630,39 L 630 776" fill="none" stroke="black" stroke-dasharray="none" stroke-width="1"/><g transform="translate(100.5, 51)"><rect width="146" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[https] register new agent</tspan></text></g><g transform="translate(45, 82)"><rect width="213" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">https client -&gt; net.Conn -&gt; rpc server</tspan></text></g><g transform="translate(326, 113)"><rect width="213" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">https server -&gt; net.Conn -&gt; rpc client</tspan></text></g><g transform="translate(326, 144)"><rect width="205" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">add agent x to the global agent pool</tspan></text></g><g transform="translate(422.5, 175)"><rect width="99" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[https] get agents</tspan></text></g><g transform="translate(391.5, 206)"><rect width="161" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[https] agent pool: x, y, z ...</tspan></text></g><g transform="translate(338, 237)"><rect width="268" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[websocket] create new session X from agent x</tspan></text></g><g transform="translate(57, 268)"><rect width="233" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[rpc] create new session X with factory f</tspan></text></g><g transform="translate(67.5, 299)"><rect width="212" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[https] register new session X from x</tspan></text></g><g transform="translate(326, 330)"><rect width="248" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">add session X to the session pool of agent x</tspan></text></g><g transform="translate(45, 361)"><rect width="228" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">https client -&gt; net.Conn -&gt; gRPC server</tspan></text></g><g transform="translate(326, 392)"><rect width="228" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">https server -&gt; net.Conn -&gt; gRPC client</tspan></text></g><g transform="translate(45, 423)"><rect width="194" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">spawn new session using factory f</tspan></text></g><g transform="translate(45, 454)"><rect width="109" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">read session output</tspan></text></g><g transform="translate(95, 485)"><rect width="157" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[gRPC] send session output</tspan></text></g><g transform="translate(326, 516)"><rect width="316" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">receive gRPC output and convert to websocket message</tspan></text></g><g transform="translate(381, 547)"><rect width="182" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[websocket] send session output</tspan></text></g><g transform="translate(642, 578)"><rect width="245" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">receive session output and print to xterm.js</tspan></text></g><g transform="translate(642, 609)"><rect width="168" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">read user input from xterm.js</tspan></text></g><g transform="translate(372.5, 640)"><rect width="199" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="normal" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[websocket] send user input to hub</tspan></text></g><g transform="translate(326, 671)"><rect width="309" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">receive websocket input and convert to gRPC message</tspan></text></g><g transform="translate(95, 702)"><rect width="157" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">[gRPC] receive client input</tspan></text></g><g transform="translate(45, 733)"><rect width="107" height="19" stroke="none" fill="white" stroke-width="1" transform="translate(0, 0)" rx="5"/><text fill="black" font-size="14" font-weight="bold" transform="translate(1, 1)" alignment-baseline="middle"><tspan x="0" dy="14">write session input</tspan></text></g></svg>